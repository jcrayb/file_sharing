<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <title>Chris' Cloud Sharing Site</title>
    <link rel="shortcut icon" href="/static/icons/favicon.ico"/>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <!-- BOOSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- FIREBASE & FIREBASE UI-->
    <script src="https://www.gstatic.com/firebasejs/9.13.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.13.0/firebase-auth-compat.js"></script>

    <!-- CODE HIGHLIGHTING -->
    <link rel="stylesheet" id='darkTheme' href="/static/css/atom-one-dark.css" disabled>
    <link rel="stylesheet" id="lightTheme" href="/static/css/stackoverflow-light.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>


    <!-- CUSTOM CSS-->
    <!-- OTHER PROPERTIES-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- INITIALIZE FIREBASE-->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB6bEl67ZxanQn2HkGZ4dADE3H2-vUHBAQ",
      authDomain: "jcrayb-cloud.firebaseapp.com",
      projectId: "jcrayb-cloud",
      storageBucket: "jcrayb-cloud.appspot.com",
      messagingSenderId: "46961130152",
      appId: "1:46961130152:web:eb0226d595ba870844609d"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
<script>hljs.highlightAll();</script>

<script>
function copyToClipboard(){
  var codeBox = document.getElementById('raw')
  text = codeBox.innerHTML
  navigator.clipboard.writeText(text);
}

function lightTheme(){
   document.getElementById('lightTheme').removeAttribute('disabled');
   document.getElementById('darkTheme').setAttribute('disabled', 'disabled');
}

function darkTheme(){
   document.getElementById('darkTheme').removeAttribute('disabled');
   document.getElementById('lightTheme').setAttribute('disabled', 'disabled');
}
</script>

<script>
  function generateCode(uid){
    path = document.getElementById('path').innerHTML
    console.log(path)
    document.getElementById('response_text').innerHTML = 'Submitted!'
    fetch(`/getcode?uid=${uid}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({path}),
    })
    .then(response => response.json())
    .then(data => {
      error = data['error'];
      if (error!==''){
        document.getElementById('response_text').innerHTML = 'An error has occured, please try again.';
        return ''
      }
      code = data['code'];
      document.getElementById('response_text').innerHTML = `Here is your shareable link: /file/${code}`;
    })
    .catch(error => {
      console.error('Error:', error);
      // Handle the error here
    });
  }
</script>
</head>
<body>
  <div id="userSection">
    <div id="userInfoContainer"></div>
    <button id="signout" onclick="signOut()" class="text-center btn btn-primary" style="display:none;">Sign Out</button>
  </div>
  <a href="/"><button type="button" name="button">Return to main page</button></a>

<div class="container">
  <div class="row w-100 mx-0">
    <div class="col-md-2 px-1">
      <button type="button" class=" btn btn-light btn-sm w-100 btn-outline-dark" onclick="window.location.href = '{{raw}}'">Get raw file</button>
    </div>
    <div class="col-md-2 px-1">
        <button type="button" class="btn btn-light btn-sm w-100 btn-outline-dark" onclick="lightTheme()">Light theme</button>
    </div>
    <div class="col-md-2 px-1">
      <button type="button" class="btn btn-light btn-sm w-100 btn-outline-dark" onclick="darkTheme()">Dark theme</button>
    </div>
    <div class="col-md-4 px-1">
      <p id='response_text' class="w-100"></p>
    </div>
    <div class="col-md-2 px-1">
      <button type="button" class="btn btn-light btn-sm w-100 btn-outline-dark" onclick="generateCode()">Share</button>
    </div>
  </div>

  <pre><code class='language-{{language}}' style="display:block; width:100%; padding:20px; border-radius:10px; overflow-x:auto;" id='codebox'>{{content}}</code></pre>
</div>
<div id="path" style="display:none">{{path|safe}}</div>
<script>
firebase.auth().onAuthStateChanged((user) => {
    if (user) {
      document.getElementById('signout').style.display = 'block'
      uid = user.uid;
      userGraphic = `<a href='/user/${uid}'><div id='userInfo'><img id='userImg' src='${user.photoURL}'><div id='userText'><p style='font-weight:bold;'>${user.displayName}</p><p>${user.email}</p></div></div><a>`
      document.getElementById('userInfoContainer').innerHTML = userGraphic;
    }
    else{
      uid=''
      userGraphic = '<div id="userInfoContainer"><div id="userInfo"><a href="/login" style="font-weight:bold;"><p>Click to login</p></a></div></div>';
      document.getElementById('userInfoContainer').innerHTML = userGraphic;
      console.log('No user is signed in...');
    }
});
</script>
</body>
</html>
